trigger:
- master
- feature/*
- hotfix/*
- refs/tags/*

pr: none

stages:
- stage: build
  displayName: Build

  jobs:
  - template: build/azure-pipelines.build.yml
    parameters:
      configurations:
        - name: amd64
          jobName: Linux
          vmImage: ubuntu-16.04
        - name: windows-amd64
          jobName: Windows
          vmImage: windows-2019

- stage: deployLocalhost
  displayName: Deploy - localhost
  variables:
  - group: docker-registry-localhost
  
  jobs:
  - template: build/azure-pipelines.deploy.yml
    parameters:
      name: Linux
      vmImage: ubuntu-16.04
      configuration: amd64
      dockerRegistryServiceConnection: ''

  - template: build/azure-pipelines.deploy.yml
    parameters:
      name: Windows
      vmImage: windows-2019
      configuration: windows-amd64
      dockerRegistryServiceConnection: ''

- stage: deployDockerIo
  displayName: Deploy - docker.io
  variables:
  - group: docker-registry-dockerio

  jobs:
  - template: build/azure-pipelines.deploy.yml
    parameters:
      name: Linux
      vmImage: ubuntu-16.04
      configuration: amd64
      dockerRegistryServiceConnection: docker-registry-dockerio

  - template: build/azure-pipelines.deploy.yml
    parameters:
      name: Windows
      vmImage: windows-2019
      configuration: windows-amd64
      dockerRegistryServiceConnection: docker-registry-dockerio
